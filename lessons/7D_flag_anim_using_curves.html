<!DOCTYPE html>
<html lang="en">

<head>
    <title>flag animation using curves</title>
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>

<body>
    <div class="title-holder">
        <div class="info-holder">
            <div class="title">flag animation using curves</div>
            <!-- <div class="subtitle">two control points</div> -->
        </div>
    </div>
    <div class="content-holder">
        <div class="section-holder">
            <div class="svg-holder">

                <svg width="500" height="500" xmlns="http://www.w3.org/2000/svg">
                    <style>
                        .handle {
                            stroke: black;
                            stroke-width: 4;
                        }
                    </style>
                    <path id="my_path" d="M 0,250 Q 125,200 250,250 T 500,250" stroke="black" stroke-width="2"
                        fill="blue" fill-opacity=".5" />

                        <path id="flag_path" d="" stroke="black" stroke-width="2"
                        fill="transparent" />

                        <path d="M 0,250 Q 50,200 100,250 Q 150,300 200,250" fill="none" stroke="black"/>


                    <circle opacity="0" class="handle" id="control_point" cx="125" cy="200" r="15" fill="blue" stroke="black">
                    </circle>



                    <!-- <rect x="-5" y="-5" width="10" height="10" transform="translate(250 250) rotate(45)"></rect> -->
                </svg>


            </div>
            <div id="info_text" class="info">aaa</div>
        </div>
        <div class="section-holder">
            <div class="description">
                <p>The smooth cubic command (S or s) draws a cubic curve from the current point (in this case, the
                    second of the two
                    control points prior to the command) to the cubic control point after the command, assuming a cubic
                    control point that is the reflection of the previous cubic control point.</p>
            </div>
        </div>
    </div>
</body>
<script>
    const svg = document.querySelector("svg");
    const control_point = document.querySelector("#control_point");
    let maxAmplitude = 100;
    let currentAmplitude = maxAmplitude;
    let dy = 0;
    let angle = 0;
    let angleIncrement = .02;

    const leftTop = {
        x: -50,
        y: 100
    }

    const flagWidth = 500 - (2*leftTop.x);
    const flagHeight = 500 - (2*leftTop.y);

    const leftBottom = {
        x: leftTop.x,
        y: leftTop.y + flagHeight
    }

    const centerTop = {
        x: leftTop.x + flagWidth/2,
        y: leftTop.y
    }

    const centerBottom = {
        x: centerTop.x,
        y: centerTop.y + flagHeight
    }

    const rightTop = {
        x: centerTop.x + flagWidth/2,
        y: centerTop.y
    }

    const rightBottom = {
        x: rightTop.x,
        y: rightTop.y + flagHeight
    }

    const my_path = document.querySelector("#my_path");

    const updateAngle = () => {
        angle += angleIncrement;
        if(angle > 360){
            angle = angle - 360
        }

    }

    const updateDY = ()=>{
        dy = Math.sin(angle) * currentAmplitude;
    }

    const updateControlPoint = ()=>{
        control_point.setAttribute("cy", 250 - dy);
    }

    const updatePath_old = ()=>{
        const newPath = `M 0,250 Q 125,${250 - dy} 250,250 T 500,250`
        my_path.setAttribute("d", newPath)
    }

    const updatePath = ()=>{
        const newPath = `M ${leftTop.x},${leftTop.y}  Q ${leftTop.x + flagWidth/4},${leftTop.y - dy} ${centerTop.x},${centerTop.y} T ${rightTop.x},${rightTop.y} v${flagHeight} Q${rightBottom.x - flagWidth/4},${rightBottom.y + dy} ${centerBottom.x},${centerBottom.y} T${leftBottom.x},${leftBottom.y} Z`;
        my_path.setAttribute("d", newPath)
    }

    const draw = ()=>{
        updateAngle();
        updateDY();
        updateControlPoint();
        updatePath();
        requestAnimationFrame(draw);
    }

    draw();


</script>

</html>
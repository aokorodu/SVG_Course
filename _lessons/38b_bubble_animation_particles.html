<!DOCTYPE html>
<html lang="en">

<head>
    <title>bubble animation</title>
    <script src="./custom-slider-component.js"></script>
    <script src="./custom-button-component.js"></script>
    <script src="./js/highlight/highlight.min.js"></script>
    <link rel="stylesheet" href="js/highlight/styles/default.min.css">
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>

<body>
    <div class="title-holder">
        <div class="info-holder">
            <div class="title">bubble animation</div>
        </div>
    </div>
    </div>
    <div class="content-holder">
        <div class="section-holder">
            <div class="svg-holder">
                <!--
                    
                -->
                <svg width="500" height="500" viewbox="0 0 500 500">
                    <defs>
                        <linearGradient id="sea-gradient" x1="250" y1="0" x2="250" y2="500"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="#3ED1FF" />
                            <stop offset="1" stop-color="#005A77" />
                        </linearGradient>
                        <radialGradient id="paint0_radial" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                            gradientTransform="translate(0 -25) rotate(90) scale(30.25)">
                            <stop stop-color="white" stop-opacity="0.33" />
                            <stop offset="1" stop-color="white" stop-opacity="0" />
                        </radialGradient>
                        <g id="bubble">
                            <g id="main-body">
                                <circle r="25" fill="none" stroke="white" stroke-width="4" stroke-opacity=".1" />
                            </g>
                            <ellipse id="large-reflection" cy="-18.375" rx="14.75" ry="6.625" fill="white"
                                fill-opacity="0.05" />
                            <ellipse id="small-reflection" cy="-21.625" rx="9" ry="3.375" fill="white"
                                fill-opacity="0.05" />
                        </g>
                    </defs>
                    <g id="bubble-holder" clip-path="url(#flask_clip)">
                        <rect id="blue_gradient" width="500" height="500" fill="url(#sea-gradient)" />
                    </g>

                </svg>

            </div>
            <div id="info_text" class="info">container size: 500px x 500px </div>
            <div class="slidecontainer">
                <custom-slider id="flask_scale" minimum="-10" maximum="10" step="0.1" val="1" label="bubble speed">
                </custom-slider>
            </div>
        </div>

</body>
<script>

    const svg = document.querySelector("svg");
    const bubbleHolder = document.querySelector("#bubble-holder");
    const flaskScaleSlider = document.querySelector("#flask_scale")
    const namespace = "http://www.w3.org/2000/svg";
    const numBubbles = 40;
    const bubbles = [];
    const bubbleSpeed = 1;

    flaskScaleSlider.addEventListener("value", (e) => {
        changeSpeed(e.detail.value);
    })

    const changeSpeed = (newSpeed) => {
        for (let bubble of bubbles) {
            bubble.setSpeed(newSpeed)
        }
    }


    const makeBubbles = () => {
        for (let i = 0; i < numBubbles; i++) {

            const bubble = document.createElementNS(namespace, "use");
            const xpos = -50 + Math.random() * 600;
            const ypos = -75 + Math.random() * 650;
            const scale = .2 + Math.random() * 1;
            bubble.setAttribute("href", "#bubble");
            bubble.setAttribute("x", xpos / scale);
            bubble.setAttribute("y", ypos);
            bubble.setAttribute("transform", `scale(${scale})`);
            bubble.setAttribute("opacity", scale);


            const bubbleObj = {
                x: xpos,
                y: ypos,
                scale: scale,
                speed: 1,
                element: bubble,
                maxY: 550 / scale,
                floating: true,
                setSpeed: function (newSpeed) {
                    this.speed = newSpeed;
                    this.speed > 0 ? this.floating = true : this.floating = false;
                },
                float: function () {
                    this.y -= this.speed;
                    if (this.floating) {
                        if (this.y < -50) {
                            this.y = this.maxY;
                            this.resetX();
                        }
                    } else {
                        if (this.y > this.maxY) {
                            this.y = -50;
                            this.resetX();
                        }
                    }

                    this.element.setAttribute("x", this.x);
                    this.element.setAttribute("y", this.y);

                },
                resetScale: function () {
                    this.scale = .2 + Math.random() * 1;
                },
                resetX: function () {
                    this.x = -50 + Math.random() * 600 / this.scale;
                },
                resetY: function () {
                    this.y = this.maxY;
                },

                reset: function () {
                    this.resetX();
                    this.resetY();
                },

                pop: function () {
                    this.reset();
                    console.log('pop', this.y)
                }


            }

            bubbles.push(bubbleObj);

            // bubble.addEventListener("mouseover", ()=>{

            //     bubbleObj.pop();
            // })
            bubbleHolder.appendChild(bubble);
        }
    }

    const floatBubbles = () => {
        for (let bubble of bubbles) {
            bubble.float();
        }
        requestAnimationFrame(floatBubbles)
    }

    const scaleFlask = (newScale) => {
        const str = `translate(250 250) scale(${newScale})`;
        bottleFillClip.setAttribute("transform", str);
        flask.setAttribute("transform", str);
    }

    makeBubbles();
    floatBubbles();


</script>

</html>